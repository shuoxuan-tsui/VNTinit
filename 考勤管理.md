# 考勤管理功能实现详解

本文档详细阐述 VNTinit 项目中"考勤管理"模块的技术实现、当前状态以及未来的开发规划。

---

## 1. 功能概述与当前状态

考勤管理模块旨在为公司提供一套完整的员工出勤跟踪和管理的解决方案。

### 1.1 规划中的功能

- **每日打卡**: 员工可以进行上班签到和下班签退。
- **考勤日历与列表**: 以日历和列表两种视图展示员工的月度及历史考勤记录。
- **状态管理**: 自动或手动记录员工的考勤状态，如正常、迟到、早退、缺勤、请假、加班等。
- **异常申诉**: 员工可以对异常的考勤记录（如忘记打卡）提交申诉。
- **请假申请与审批**: 提供完整的请假申请流程，并支持多级审批。
- **统计报表**: 生成个人和部门的月度/年度考勤统计报表。

### 1.2 当前实现状态

考勤管理模块目前处于 **"后端 API 未开发"** 的阶段。

- **已完成**:
  - **数据模型**: 后端 `models.py` 中已定义了详细的 `AttendanceRecord` 模型。
  - **前端界面**: `frontend/pages/attendance/index.vue` 已经构建了完整的用户界面，包括统计卡片、标签页、筛选器和数据列表，目前使用静态模拟数据进行填充。
- **未完成**:
  - **后端 API**: 后端尚未开发用于处理考勤数据 CRUD、统计和审批流程的 API 视图和序列化器。
  - **前后端对接**: 前端页面与后端的数据交互逻辑尚未实现。

---

## 2. 已有实现详解

### 2.1 后端数据模型 (`models.py`)

- **`AttendanceRecord` 模型**: 这是考勤功能的数据基石。
  - **核心字段**: `employee` (外键), `date` (考勤日期), `check_in_time`, `check_out_time`, `status` (考勤状态), `work_hours`, `overtime_hours`, `notes`。
  - **状态定义**: `status` 字段通过 `choices` 定义了多种考勤状态（'present', 'late', 'sick_leave' 等），为未来的功能实现提供了良好的枚举基础。
  - **唯一约束**: `unique_together = ['employee', 'date']` 约束确保了每个员工每天只能有一条考勤主记录。

### 2.2 前端界面 (`pages/attendance/index.vue`)

前端页面已经预先设计和搭建好了丰富的 UI，为未来的功能开发奠定了基础。

- **布局与组件**:

  - **统计卡片**: 页面顶部展示"今日已签到"、"迟到"、"缺勤"等核心统计指标。
  - **操作按钮**: 包含"打卡签到"、"申请请假"、"导出数据"等交互入口。
  - **标签页 (Tabs)**: 设计了"考勤记录"、"考勤统计"、"休假管理"和"审批中心"等多个标签页，规划了清晰的功能分区。
  - **筛选与搜索**: 在"考勤记录"标签页下，已经预置了按员工、部门、状态和日期范围进行筛选的控件。

- **当前数据来源**:
  - 页面中的所有数据（如统计数字、列表记录）目前均来自 `<script setup>` 中定义的静态 `ref` 变量。
  - 在开发日志 (`django.log`) 中可以看到，页面曾尝试调用 `/api/attendance/trends/` 等接口，但因后端未实现而返回 404 错误。这为后续 API 的设计提供了参考。

---

## 3. 未来开发规划

要使考勤管理功能完整可用，需要完成以下开发工作：

1.  **开发后端 API**:

    - **CRUD 接口**: 为 `AttendanceRecord` 模型创建标准的 `ListCreateAPIView` 和 `RetrieveUpdateDestroyAPIView` 视图及对应的序列化器。
    - **打卡接口**: 创建一个专门的 API 端点（例如 `POST /api/attendance/check-in/`），用于处理用户的打卡操作。该接口需要判断当前是签到还是签退，并记录时间。
    - **统计接口**: 创建用于计算和返回"今日考勤概览"和"月度统计"等数据的 API 端点（例如 `/api/attendance/stats/`）。
    - **审批流接口**: 为请假和申诉功能设计相应的模型和 API，处理申请的提交、状态流转和审批操作。

2.  **实现前后端对接**:

    - 在 `pages/attendance/index.vue` 中，将所有使用静态数据的地方替换为对后端 API 的真实调用。
    - 为"打卡"、"申请请假"等按钮绑定事件处理函数，实现与后端接口的交互。
    - 将筛选和搜索功能与后端列表接口的查询参数对接。

3.  **完善权限控制**:
    - 为考勤相关的 API 设置精细的权限。例如，普通员工只能为自己打卡、查看自己的记录；部门经理可以查看本部门员工的考勤；HR 和管理员拥有最高权限。
